var pageBuilder={init:function(){$.event.addProp("dataTransfer"),$(window).resize(pageBuilder.resize),pageBuilder.resize(),pageBuilder.bind(),pageBuilder.loadIframe()},initControllers:function(e){Components.init(),Elements.init(),Editor.init()},initContainers:function(){var e=this;e.iframe=$("#builder-preview-iframe"),e.container=$("#builder-preview-iframe").contents().find("#pb-page-builder"),e.sidebar=$("#pb-page-builder-sidebar"),e.components=$("#pb-sidebar-components"),e.elements=$("#pb-sidebar-elements"),e.editor=$("#pb-sidebar-editor")},bind:function(){$("#pb-sidebar-main-menu a").on("click",pageBuilder.sidebarNav)},resize:function(){pageBuilder.viewport_height=$(window).height(),pageBuilder.viewport_width=$(window).width(),pageBuilder.mobile=!!(navigator.userAgent.match(/Mobile|iP(hone|od|ad)|Android|BlackBerry|IEMobile/i)||pageBuilder.viewport_width<1024)},check:function(e,t){return void 0!==$(e).attr(t)},hidePreloader:function(e){$("#pb-iframe-preloader").fadeOut()},showPreloader:function(e){$("#pb-iframe-preloader").fadeIn()},loadIframe:function(){if("undefined"!=typeof iframe_url){var e='<iframe id="builder-preview-iframe" src="http://'+iframe_url+'" allowfullscreen="1"></iframe>';$("#gs-pb-iframe-holder").append(e),$("#builder-preview-iframe").on("load",function(){pageBuilder.hidePreloader(),pageBuilder.initContainers(),pageBuilder.initControllers()})}},sidebarNav:function(e){e&&e.preventDefault();var t=$(this),i=t.attr("href");void 0===i||t.hasClass("active")||($("#"+i).addClass("active").siblings().removeClass("active"),t.addClass("active").siblings().removeClass("active"),null!==Editor.elem&&(Editor.elem=null,pageBuilder.container.find(".pb-editing").removeClass("pb-editing")))}},Components={component_id:null,init:function(){this.bind(),this.appendSection(),this.setUniqueId(),this.sortableComponents(),this.sortableContainers(),this.appendHelpers()},bind:function(){pageBuilder.components.on("dragstart",".pb-drop-handler",Components.appendDroppableArea),pageBuilder.components.on("dragend",".pb-drop-handler",Components.removeDroppableArea),pageBuilder.container.on("dragenter",".pb-droppable-area, .pb-new-section-inner",Components.focusDroppableArea),pageBuilder.container.on("dragover",".pb-droppable-area, .pb-new-section-inner",Components.preventDragOver),pageBuilder.container.on("drop",".pb-droppable-area, .pb-new-section-inner",Components.dropComponents),pageBuilder.container.on("click",".pb-delete-widget",Components.removeWidget)},sortableContainers:function(){pageBuilder.container.length&&pageBuilder.container.sortable({handle:$(this).closest(".pb-sort-icon"),cancel:".pb-new-section-inner",classes:{"ui-sortable":"pb-sortable-item"}})},setUniqueId:function(){var e=pageBuilder.components.find(".pb-drop-handler");e.length&&e.each(function(e){$(this).attr("id","pb-drag-handler-"+e)})},appendDroppableArea:function(e){e.dataTransfer.setData("html",e.target.id);var t=pageBuilder.container.find("[data-widget]");Components.component_id=$(this),t.length&&t.each(function(){$(this).after($('<div class="pb-droppable-area"></div>'))})},removeDroppableArea:function(e){var t=pageBuilder.container.find(".pb-droppable-area"),i=pageBuilder.container.find(".pb-new-section-inner");setTimeout(function(){t.length&&(t.remove(),i.removeClass("ready-to-drop"),Components.component_id=null)},100)},focusDroppableArea:function(e){e.preventDefault(e);var t=$(this);pageBuilder.container.find(".pb-new-section-inner").removeClass("ready-to-drop"),pageBuilder.container.find(".ready-to-drop").removeClass("ready-to-drop"),t.addClass("ready-to-drop")},preventDragOver:function(e){e.preventDefault()},dropComponents:function(e){e.preventDefault();var t=e.dataTransfer.getData("html",e.target),i=$(this);Components.loadComponent(t,i)},loadComponent:function(e,t){var i=$("#"+e);component_url=i.data("component"),"undefined"!=typeof component_url&&null!==Components.component_id&&$.ajax({url:component_url,type:"post",data:{},success:function(e){Components.appendComponent(i,t,e)}})},appendComponent:function(e,t,i){t.hasClass("pb-droppable-area")&&e.length&&t.after(i),t.hasClass("pb-new-section-inner")&&e.length&&Components.wrapWidgetToSection(t,i),Components.removeDroppableArea(),Components.sortableComponents(t),Components.appendHelpers(),Elements.appendElemHelpers(),Elements.appendColumnHelpers(),Elements.sortableElements(),Elements.sortableColumns()},wrapWidgetToSection:function(e,t){var i='<div class="gs-section ui-sortable-handle" data-sortable-container><div class="gs-section-wrap">'+t+"</div></div>";e.before(i).removeClass("ready-to-drop")},sortableComponents:function(e){var t=void 0!==e?e:pageBuilder.container.find("[data-widget]");null!==pageBuilder.container&&void 0!==t&&t.parent().sortable({handle:".pb-sort-icon",classes:{"ui-sortable":"pb-sortable-item"}})},appendSection:function(){pageBuilder.container.find(".gs-section").last().after('<div class="gs-section pb-new-section-inner"><div class="gs-section-wrap"><div class="pb-add-section"><div class="pb-add-section-text">Drag widget here</div></div></div></div>')},appendHelpers:function(){var e=pageBuilder.container.find("[data-widget]");e.each(function(){var e=$(this);0==e.find(".pb-editor-settings").length&&pageBuilder.check(e,"data-widget")&&e.append('<div class="pb-editor-settings"><div class="pb-editor-ui"><span class="pb-ui-icon pb-delete-icon icon-close pb-delete-widget pb-delete-ui" title="Remove"></span><span class="pb-ui-icon pb-widget-duplicate-icon icon-icon-file pb-duplicate-coll pb-duplicate-ui" title="Copy"></span><span class="pb-ui-icon pb-sort-icon icon-star"  title="Edit"></span></div></div>')})},removeWidget:function(){var e=$(this).parents("[data-widget]");Components.resetEditedElem(e),0<e.siblings().length?e.remove():e.parents(".gs-section").remove()},resetEditedElem:function(e){null!==Editor.elem&&0!==e.find(".pb-editing").length&&(Editor.elem=null,$("#pb-components-btn").trigger("click"))}},Editor={style_id:[],chache_styles:header_chache_styles,settings:{container:{default:["width","border","dimensions","background","typography"],main:["width","border","dimensions","background","typography"],inline:["width","border","dimensions"],grid:["width","align-items-verical","align-items-horizontal","border","dimensions","background"]},column:{default:["width","border","dimensions"],grid:["width","border","dimensions","background"]},title:{default:["text-editor","change-title-tags","insert-link","typography","border","dimensions"]},paragraph:{default:["text-editor","typography","size","border","dimensions"],data_base:["size","typography","border","dimensions"]},image:{default:["media","width","height","border","dimensions","insert-link"],grid:["media","width","border","dimensions","insert-link"]},button:{default:["text-editor","typography","edit-link","size","border","dimensions","background"]}},media_settings:{desktop:"",tablet:"@media screen and (max-width: 1025px){",mobile:"@media screen and (max-width: 640px){"},media_viewport:"desktop",elem:null,init:function(){this.bind(),Media.init()},bind:function(){pageBuilder.container.on("click","[data-editable]",Editor.focusEditble),pageBuilder.container.on("click",Editor.unFocusEditble),pageBuilder.editor.on("change",".pb-controlls-val",Editor.styleElem),pageBuilder.editor.on("input change",".pb-ui-dim-input",Editor.collectDimensionValues),pageBuilder.editor.on("input change","[data-tool=text-editor]",Editor.updateElementText),pageBuilder.editor.on("input change",".pb-insert-link-val",Editor.insertLink),pageBuilder.editor.on("input change",".pb-edit-link-val",Editor.editLink),pageBuilder.editor.on("change",".pb-change-html-tag",Editor.changeHTMLTags),pageBuilder.editor.on("change",".pb-link-attr-val",Editor.addLinkAttributes),pageBuilder.editor.on("click","#pb-editor-menu a",Editor.showEditorMenuSection),pageBuilder.editor.on("click",".pb-link-dimensions",Editor.observeDimensionValues),pageBuilder.editor.on("click",".pb-lang-type span",Editor.changeInputLang),pageBuilder.editor.on("click",".pb-show-observe-tool",Editor.showHiddenTools),$("#pb-iframe-size").on("click","button",Editor.changeViewport)},isEmptyChasche:function(e){return 0===Object.keys(e).length},changeViewport:function(e){var t=$(this),i=t.data("viewport");t.hasClass("active")||(t.addClass("active").siblings().removeClass("active"),pageBuilder.iframe.removeAttr("class").addClass(i),Editor.media_viewport=i,0!==pageBuilder.container.find(".pb-editing").length&&Editor.chache_styles.hasOwnProperty(Editor.elem.attr("id"))&&setTimeout(function(){Editor.updateViewportCss()},50))},resetViewportCss:function(e){var t=pageBuilder.sidebar.find("input.pb-controlls-val , input.pb-ui-dim-input"),i=pageBuilder.sidebar.find("select.pb-ui-handler-select");t.val(""),i.prop("selectedIndex",0)},updateViewportCss:function(e){var t=Editor.chache_styles[Editor.elem.attr("id")].styles;void 0!==t&&t.hasOwnProperty(Editor.media_viewport)&&(Editor.resetViewportCss(),$.each(t[Editor.media_viewport],function(e,t){Editor.applyStyles(e,t)}))},showEditorMenuSection:function(e){e&&e.preventDefault();var t=$(this);type=t.data("tool-type"),tools=pageBuilder.editor.find("[data-type]"),target=pageBuilder.editor.find("[data-type="+type+"]"),t.hasClass("active")||(tools.hide(),t.addClass("active").siblings().removeClass("active"),target.show(),$("#pb-sidebar-main-menu .pb-main-nav-link").removeClass("active"))},elemOver:function(e){var t=$(e.target),i=pageBuilder.check(t,"data-editable")?t:t.closest("[data-editable]");$("[data-editable]").removeClass("focus"),i.addClass("focus")},elemLeave:function(e){$(this).removeClass("focus")},focusEditble:function(e){e&&e.preventDefault();var t=$(e.target);if(!t.hasClass("pb-delete-ui")&&!t.hasClass("pb-duplicate-ui")){var i=pageBuilder.check(t,"data-editable")?t:t.closest("[data-editable]");options=i.attr("data-editable"),Editor.createUniqueId(i),!i.hasClass("pb-editing")&&pageBuilder.check(i,"data-editable")&&(pageBuilder.container.find("[data-editable]").removeClass("pb-editing"),i.addClass("pb-editing"),Editor.showEditor(t,i,options),Editor.getElementName(t))}},unFocusEditble:function(e){var t=$(e.target);0==(pageBuilder.check(t,"data-editable")?t:t.closest("[data-editable]")).length&&(pageBuilder.container.find("[data-editable]").removeClass("pb-editing"),Editor.elem=null,$("#pb-components-btn").trigger("click"))},getElementName:function(e){var t=(pageBuilder.check(e,"data-editable")?e.data("editable"):e.closest("[data-editable]").data("editable")).split(".");$("#pb-edited-elem-name").text(t[0])},showEditor:function(e,t,i){if(void 0!==i){var a=i.split(".");Editor.settings[a[0]].hasOwnProperty(a[1])?(pageBuilder.editor.addClass("active").siblings().removeClass("active"),Editor.loadTools(e,t,i)):(pageBuilder.editor.find(".pb-editor-form").html(""),$("#pb-sidebar-main-menu a").eq(0).trigger("click"))}},getActiveTools:function(e,t,i){var a=t.split("."),n=Editor.settings[a[0]][a[1]],r=[];if(void 0!==n){for(var o=0;o<n.length;o++)r.push(i.filter("[data-edit="+n[o]+"]"));return r}},loadTools:function(i,a,n){void 0!==i&&void 0!==n&&$.ajax({url:"ajax/tools/tools.php",type:"post",data:{},dataType:"html",success:function(e){if(e){var t=$(e);pageBuilder.editor.find(".pb-editor-form").html(Editor.getActiveTools(i,n,t)),Editor.elem=a,Editor.updateEditorMenu(),Editor.addStyleTag(Editor.elem.attr("id")),Editor.getStyles(),Editor.getElemText(Editor.elem),Editor.updateImageTool(),Colorpicker.init(t)}}})},updateEditorMenu:function(){var e=pageBuilder.editor.find(".pb-edit-tool"),t=[];e.each(function(){var e=$(this).data("type");-1===$.inArray(e,t)&&t.push(e)}),Editor.resetEditorMenu(t)},resetEditorMenu:function(e){var t=$("#pb-editor-menu a");t.hide().removeClass("active");for(var i=0;i<e.length;i++)t.filter("[data-tool-type="+e[i]+"]").show();t.filter(":visible:first").trigger("click")},addStyleTag:function(e){var t=pageBuilder.iframe.contents().find("head")[0],i=document.createElement("style"),a="pb-style-"+e;i.type="text/css",i.id=a,-1===Editor.style_id.indexOf(a)&&(Editor.style_id.push(a),t.appendChild(i))},createUniqueId:function(e){var t=void 0!==e.attr("class")?e.attr("class"):"pb-element";e.prop("id")||e.prop("id",t.split(/\s(.+)/)[0]+"-"+(new Date).getTime())},styleElem:function(e){var t=pageBuilder.editor.find(".pb-controlls-val");Editor.media_viewport;if(null!=Editor.elem){for(var i=0;i<t.length;i++)if(""!==$(t[i]).val()){var a=$(t[i]),n=a.attr("data-tool"),r=pageBuilder.check(a,"data-unit")?a.attr("data-unit"):"",o=a.val();Editor.chache_styles.hasOwnProperty(Editor.elem.attr("id"))||(Editor.chache_styles[Editor.elem.attr("id")]={}),Editor.chache_styles[Editor.elem.attr("id")].styles=Editor.createStyleObject(n,o,r)}Editor.computeStyles(),Editor.showObservedTools($(this))}},createStyleObject:function(e,t,i){var a=Editor.chache_styles[Editor.elem.attr("id")],n=Editor.media_viewport,r={};return void 0!==a&&a.hasOwnProperty("styles")&&(r=a.styles).hasOwnProperty(n)||(r[n]={}),r[n][e]=t+""+i+";",Editor.sortStyleObject(r)},sortStyleObject:function(e){var t=[],i={},n=Object.keys(Editor.media_settings);for(var a in e)e.hasOwnProperty(a)&&t.push([a,e[a]]),t.sort(function(e,t){var i=e[0].toLowerCase(),a=t[0].toLowerCase();return n.indexOf(i)-n.indexOf(a)});for(var r=0;r<t.length;r++)i[t[r][0]]=t[r][1];return i},computeStyles:function(e,t,i){var a=pageBuilder.iframe.contents().find("#pb-style-"+Editor.elem.attr("id")),n=Editor.chache_styles[Editor.elem.attr("id")].styles;if(null!==Editor.elem&&a.length&&void 0!==n){var r="#pb-page-builder #"+Editor.elem.attr("id");a.text(Editor.createStyleText(r,n))}},createStyleText:function(n,e){var r="";return $.each(e,function(e,t){var i,a=void 0!==t?JSON.stringify(t).replace(/['",]+/g,""):"";i="desktop"==e?a:a+"}",r+=Editor.media_settings[e]+n+""+i}),r},getStyles:function(){if(Editor.getHTMLTag(),Editor.getElemLink(),Editor.chache_styles.hasOwnProperty(Editor.elem.attr("id"))){var e=Editor.chache_styles[Editor.elem.attr("id")];if(e.hasOwnProperty("styles")){var t=void 0!==e.styles[Editor.media_viewport]?e.styles[Editor.media_viewport]:Editor.getSiblingsViewports(e);$.each(t,function(e,t){Editor.applyStyles(e,t)})}}},getSiblingsViewports:function(e){var t,i=e.styles;if(!i.hasOwnProperty(Editor.media_viewport))switch(Editor.media_viewport){case"desktop":break;case"tablet":t=$.extend(!0,{},i.desktop);break;case"mobile":t=void 0!==i.tablet?$.extend(!0,{},i.tablet):$.extend(!0,{},i.desktop)}return t},applyStyles:function(e,t){if(void 0!==e&&void 0!==t){var i=pageBuilder.editor.find(".pb-controlls-val[data-tool="+e+"]");if(i.length){if(i.hasClass("pb-ui-handler-select"))return void Editor.updateStylesSelects(i,t);if(i.hasClass("pb-controll-dimensions-val"))return void Editor.updateStylesDimension(i,t);Editor.updateStyleInputs(i,t)}}},updateStyleInputs:function(e,t){var i=t.replace(/[&\/\\px,;+()$~%.'":*?<>{}]/g,"");e.val(i).trigger("change")},updateStylesSelects:function(e,t){var i=t.replace(/\;/g,"");e.find("option").filter(function(){return this.value==i}).prop("selected",!0).trigger("change")},updateStylesDimension:function(e,t){for(var i=t.replace(/\;/g,""),a=i.split(" "),n=$.grep(a,function(e){return 0==e||e}),r=e.parent().find(".pb-controll-dimensions"),o=0;o<n.length;o++){var d=n[o].replace(/[^0-9]/g,"");r.eq(o).find(".pb-ui-dim-input").val(d)}e.val(i).trigger("change")},collectDimensionValues:function(){var e=$(this),t=e.parents(".pb-ui-dimensions"),i=e.parent().siblings().find("input.pb-ui-dim-input"),a=t.find(".pb-controlls-val"),n=t.find("input.pb-ui-dim-input"),r=t.find(".pb-link-dimensions").hasClass("active"),o="";r&&i.val(e.val()),n.each(function(){var e=0<$(this).val().length?$(this).val():"0";o+=e+"px "}),a.val(o).trigger("change")},observeDimensionValues:function(e){e.preventDefault();var t=$(this),i=t.parents(".pb-ui-dimensions");t.hasClass("active")?(t.removeClass("active"),i.removeClass("active")):(t.addClass("active"),i.addClass("active"))},showObservedTools:function(e){var t=e.attr("data-tool"),i=pageBuilder.editor.find("[data-observe-tool="+t+"]");void 0!==i&&(0<e.val().length&&["none","default","inherit","auto"].indexOf(e.val())<0?i.show():i.hide())},showHiddenTools:function(e){var t=$(this),i=t.data("show-observe-tool"),a=pageBuilder.editor.find("[data-observe-tool="+i+"]");void 0!==a&&(t.hasClass("active")?(t.removeClass("active"),a.hide()):(t.addClass("active"),a.show()))},getElemText:function(e){var t=e.data("editable");if(void 0!==t&&0<t.length){var i=t.split(".");if(Editor.settings[i[0]][i[1]].includes("text-editor")){var a="string"==typeof e.contents().get(0).nodeValue?e.contents().get(0).nodeValue:e.contents().get(0).text;0<a.length&&(Editor.chache_styles.hasOwnProperty(Editor.elem.attr("id"))?Editor.chache_styles[Editor.elem.attr("id")].text=Editor.createTextLang(a):Editor.chache_styles[Editor.elem.attr("id")]={text:Editor.createTextLang(a)},Editor.updateTextEditor())}}},createTextLang:function(e){var t=pageBuilder.editor.find("#pb-lang-type"),i=Editor.chache_styles[Editor.elem.attr("id")];if(t.length){var a=t.find("span.active").data("lang");if(void 0!==i&&i.hasOwnProperty("text"))var n=i.text;else(n={})[a]=e}return n},updateTextLang:function(e){var t=pageBuilder.editor.find("#pb-lang-type"),i=Editor.chache_styles[Editor.elem.attr("id")];if(t.length){var a=t.find("span.active").data("lang");if(void 0!==i&&i.hasOwnProperty("text")){var n=i.text;n[a]=e}}return n},updateTextEditor:function(){var e=pageBuilder.editor.find("[data-tool=text-editor]"),t=Editor.chache_styles[Editor.elem.attr("id")],i=pageBuilder.editor.find("#pb-lang-type");if(void 0!==t&&t.hasOwnProperty("text")){var a=t.text,n=i.find("span.active").data("lang"),r=void 0!==a[n]?a[n].trim():"";e.val(r),0<e.val().length&&e.trigger("change").attr("placeholder","Type text here ..."),setTimeout(function(){e.focus()},50)}},updateElementText:function(){var e=pageBuilder.editor.find("[data-tool=text-editor]");if(null!==Editor.elem){var t=Editor.elem.contents().get(0).nodeValue,i=Editor.elem.contents().get(0).nodeName;"string"==typeof t&&"#text"==i?Editor.elem.contents().get(0).nodeValue=e.val():Editor.elem.children().eq(0).text(e.val()),Editor.chache_styles[Editor.elem.attr("id")].text=Editor.updateTextLang(e.val())}},checkForEmptyText:function(e){return!(null===typeof e||void 0===e||!e)&&e.replace(/\s/g,"")},changeInputLang:function(e){var t=$(this),i=pageBuilder.editor.find("[data-tool=text-editor]");t.hasClass("active")||(t.addClass("active").siblings().removeClass("active"),i.focus(),Editor.updateTextEditor())},updateImageTool:function(){var e=pageBuilder.editor.find("[data-media-preview]"),t=Editor.elem.find("[data-placeholder-image]").attr("src");void 0!==t&&e.length&&-1==t.indexOf("placeholder")&&e.css("background-image","url("+t+")")},changeHTMLTags:function(){var e=$(this).val(),t=pageBuilder.container.find(".pb-editing"),i=t.html(),a="<"+e+" "+Editor.getNodesAttr(t)+">"+i+"</"+e+">";t.replaceWith(a),pageBuilder.container.find(".pb-editing").removeClass("pb-editing").trigger("click")},getHTMLTag:function(){var e=pageBuilder.editor.find(".pb-change-html-tag");if(0!==e.length){var t=Editor.elem[0].tagName;void 0!==t&&e.val(t)}},getNodesAttr:function(e){var t,i,a="";return e.each(function(){$.each(this.attributes,function(){this.specified&&(t=this.name,i=this.nodeValue,a+=t+'="'+i+'" ')})}),a},insertLink:function(e){var t,i=$(this).val(),a=Editor.elem.contents().get(0).nodeValue;if(0<i.length){if(Editor.elem.find(".pb-dynamic-link").length)return void Editor.elem.find(".pb-dynamic-link").attr("href",i);Editor.checkForEmptyText(a).length||(t=Editor.elem.children().eq(0)),Editor.insertLinkHTML(i,a,t)}else Editor.removeLinkHTML()},insertLinkHTML:function(e,t,i){var a=document.createElement("a");a.href=e,a.text=t,a.className="pb-dynamic-link",void 0!==i&&a.appendChild(i[0]),Editor.elem.contents().get(0).remove(),Editor.elem.prepend(a)},removeLinkHTML:function(){var e=Editor.elem.find(".pb-dynamic-link");if(e.length){var t=e.html();e.replaceWith(t)}},getElemLink:function(){var e="A"==Editor.elem[0].tagName?Editor.elem[0]:Editor.elem.contents().get(0);"A"==e.tagName&&pageBuilder.editor.find(".pb-ui-handler-link").val(e.getAttribute("href"))},editLink:function(){var e=$(this).val();"undefined"!==Editor.elem.attr("href")&&Editor.elem.attr("href",e)},addLinkAttributes:function(){var e=$(this),t=e.data("link-attr").split(":"),i="A"==Editor.elem[0].tagName?Editor.elem[0]:Editor.elem.contents().get(0);e.prop("checked")&&"A"==i.tagName?i.setAttribute(t[0],t[1]):e.prop("checked")||"A"!=i.tagName||i.removeAttribute(t[0])},saveCss:function(){var e=$("head").find("[id^=pb-style]");e.each(function(){console.log(e.text())})},saveElementText:function(){$.each(Editor.chache_styles,function(e,t){console.log(e,t.text)})}},Media={container:$("#pb-media-container"),init:function(){this.bind()},bind:function(){pageBuilder.sidebar.on("click",".pb-ui-media-tool",Media.showMediaGallery),Media.container.on("click",".pb-media-item",Media.selectMediaImage),Media.container.on("dblclick",".pb-media-item",Media.applyImage),Media.container.on("click","#gs-pb-add-image",Media.applyImage),$(document).keyup(function(e){27==e.keyCode&&Media.closeMediaGallery()})},showMediaGallery:function(){var e=$(this),t=$("#pb-media-container");t.hasClass("active")||(t.addClass("active"),0==t.find(".pb-media-item").length&&Media.loadMediaImages(e))},closeMediaGallery:function(e){e&&e.preventDefault();var t=$("#pb-media-container");t.hasClass("active")&&(t.removeClass("active"),Media.container.find(".pb-media-item").removeClass("active"))},loadMediaImages:function(e){$.ajax({url:"ajax/media.json",type:"post",dataType:"json",data:{},success:function(e){0!==e.images.length&&Media.createMediaItem(e.images)}})},createMediaItem:function(e){var t,i=$("#pb-media-container .pb-media-grid");i.children().length;for(var a=0;a<e.length;a++)t='<div class="pb-media-item" data-media-image="'+e[a]+'"><div class="pb-media-image"><div class="pb-background" style="background-image: url('+e[a]+');"></div></div></div>',i.append(t)},selectMediaImage:function(){var e=$(this),t=$("#gs-pb-add-image");e.hasClass("active")||(e.addClass("active").siblings().removeClass("active"),t.addClass("active"))},applyImage:function(e){e&&e.preventDefault();var t=$(this),i=Media.container.find(".pb-media-item.active").data("media-image"),a=pageBuilder.sidebar.find("[data-media-preview]");t.hasClass("active")&&null!==Editor.elem&&void 0!==i&&(Editor.elem.find("[data-placeholder-image]").attr("src",i),a.css("background-image","url("+i+")"),Media.closeMediaGallery())}},Colorpicker={init:function(e){var t=e.find("[data-colorpicker]");t.length&&this.spectrum(t)},spectrum:function(e){$(".sp-container").length&&$(".sp-container").remove(),e.parent().each(function(){var e=$(this),t=e.find("input");e.spectrum({showInput:!0,preferredFormat:"hex3",clickoutFiresChange:!0,color:t.val(),showButtons:!1,move:function(e){t.val(e).trigger("change")},change:function(e){t.val(e).trigger("change")}})})}},Elements={elem_id:null,init:function(){this.appendElemHelpers(),this.appendColumnHelpers(),this.sortableElements(),this.sortableColumns(),this.setUniqueId(),this.bind()},bind:function(){pageBuilder.elements.on("dragstart","[data-draggble-element]",Elements.droppableElements),pageBuilder.elements.on("dragend","[data-draggble-element]",Elements.unFocusDroppableArea),pageBuilder.container.on("dragenter","[data-element]",Elements.focusDroppableArea),pageBuilder.container.on("dragover","[data-element]",Elements.preventDragOver),pageBuilder.container.on("drop","[data-element]",Elements.dropElements),pageBuilder.container.on("click",".pb-delete-coll, .pb-delete-elem",Elements.removeElement),pageBuilder.container.on("click",".pb-duplicate-ui",Elements.duplicateElement)},setUniqueId:function(){var e=pageBuilder.elements.find("[data-draggble-element]");e.length&&e.each(function(e){$(this).attr("id","pb-drag-element-"+e)})},sortableElements:function(){var e=pageBuilder.container.find("[data-element]");e.length&&e.parent().sortable({handle:".pb-elem-sort-icon",cancel:$(this).find(".pb-coll-editor-settings"),start:function(e,t){t.item.addClass("highlight")},stop:function(e,t){t.item.removeClass("highlight")},classes:{"ui-sortable":"pb-sortable-item"}})},sortableColumns:function(){var e=pageBuilder.container.find("[data-column]");e.length&&e.parent().sortable({handle:".pb-coll-sort-icon",cancel:$(this).find(".pb-editor-settings"),start:function(e,t){t.item.addClass("highlight")},stop:function(e,t){t.item.removeClass("highlight")},classes:{"ui-sortable":"pb-sortable-item"}})},preventDragOver:function(e){e.preventDefault()},droppableElements:function(e){e.dataTransfer.setData("html",e.target.id),Elements.elem_id=$(this)},focusDroppableArea:function(e){var t=$(this);null!==Elements.elem_id&&-1!==Elements.elem_id.attr("id").indexOf("element")&&(pageBuilder.container.find(".ready-to-drop-element").removeClass("ready-to-drop-element"),t.addClass("ready-to-drop-element"))},unFocusDroppableArea:function(){setTimeout(function(){pageBuilder.container.find("[data-element]").removeClass("ready-to-drop-element"),Elements.elem_id=null},100)},dropElements:function(e){e.preventDefault();var t=e.dataTransfer.getData("html",e.target),i=$(this);Elements.loadElement(t,i)},loadElement:function(e,t){var i=$("#"+e);element_url=i.data("element"),"undefined"!=typeof element_url&&$.ajax({url:element_url,type:"post",data:{},success:function(e){Elements.appendElement(i,t,e)}})},appendElement:function(e,t,i){if(t.hasClass("ready-to-drop-element")&&null!==Elements.elem_id&&t.length){var a=$(i);t.after(a),t.hasClass("pb-elem-paceholder")&&t.remove()}Elements.unFocusDroppableArea(),Elements.appendElemHelpers(a),Elements.appendColumnHelpers(a),Elements.sortableElements(),Elements.sortableColumns(),Elements.elem_id=null},appendElemHelpers:function(e){var t=void 0!==e?e:pageBuilder.container.find("[data-editable]");t.each(function(){var e=$(this);0!=e.find(".pb-elem-editor-settings").length||pageBuilder.check(e,"data-column")||pageBuilder.check(e,"data-widget")||e.append('<div class="pb-elem-editor-settings"><div class="pb-editor-ui"><span class="pb-elem-ui-icon pb-elem-delete-icon icon-close pb-delete-elem pb-delete-ui" title="Remove"></span><span class="pb-elem-ui-icon pb-elem-duplicate-icon icon-icon-file pb-duplicate-elem pb-duplicate-ui" title="Copy"></span><span class="pb-elem-ui-icon pb-elem-sort-icon icon-star"  title="Edit"></span></div></div>')})},appendColumnHelpers:function(e){var t=void 0!==e?e:pageBuilder.container.find("[data-column]");t.each(function(){var e=$(this);0==e.find(".pb-coll-editor-settings").length&&pageBuilder.check(e,"data-column")&&e.append('<div class="pb-coll-editor-settings"><div class="pb-editor-ui"><span class="pb-coll-ui-icon pb-coll-sort-icon icon-star"  title="Edit"></span><span class="pb-coll-ui-icon pb-coll-duplicate-icon icon-icon-file pb-duplicate-coll pb-duplicate-ui" title="Copy"></span><span class="pb-coll-ui-icon pb-coll-delete-icon icon-close pb-delete-coll pb-delete-ui" title="Remove"></span></div></div>')})},removeElement:function(){var e=$(this).closest("[data-editable]"),t=e.siblings("[data-editable]");Elements.resetEditedElem(e),t.length<1&&e.parent().append('<div class="pb-elem-paceholder" data-element></div>'),e.remove()},resetEditedElem:function(e){null!==Editor.elem&&e.hasClass("pb-editing")&&(Editor.elem=null,$("#pb-components-btn").trigger("click"))},duplicateElement:function(e){var t=$(e.target).closest("[data-editable]"),i=t[0].outerHTML,a=$(i);Elements.getElementIds(t,a)},getElementIds:function(e,t){var i=[];void 0!==e.prop("id")&&e.prop("id").match("pb-")&&i.push(e.prop("id")),e.find("[data-editable]").each(function(){var e=$(this);void 0!==e.prop("id")&&e.prop("id").match("pb-")&&i.push(e.prop("id"))}),Elements.createCloningStyles(e,i,t)},createCloningStyles:function(e,t,i){if(0!==t.length)for(var a=0;a<t.length;a++){var n=t[a].replace(/[0-9]/g,"")+""+(new Date).getTime(),r=$.extend(!0,{},Editor.chache_styles[t[a]]);i.filter("#"+t[a]).removeClass("pb-editing").prop("id",n),i.find("#"+t[a]).removeClass("pb-editing").prop("id",n),void 0!==r&&(Editor.chache_styles[n]=r,Editor.addStyleTag(n),Elements.applyCloningStyles(n))}e.after(i),Elements.sortableColumns(),Elements.sortableElements()},applyCloningStyles:function(e){var t=pageBuilder.iframe.contents().find("#pb-style-"+e);if(t.length&&Editor.chache_styles.hasOwnProperty(e)){var i=Editor.chache_styles[e].styles,a="#pb-page-builder #"+e;t.text(Editor.createStyleText(a,i))}}};
//# sourceMappingURL=main.js.map